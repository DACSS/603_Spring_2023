---
title: "Final Project Proposal Check-in1"
author: "Meredith Derian-Toth"
description: "Initial draft of research proposal for Final Project"
date: "03/10/2023"
format:
  html:
    toc: true
    code-fold: true
    code-copy: true
    code-tools: true
---
```{r setup}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
```

```{r reading in data}

#reading in data
jobs_gender <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-03-05/jobs_gender.csv")
earnings_female <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-03-05/earnings_female.csv") 
employed_gender <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-03-05/employed_gender.csv") 

#bringing in libraries
library(dplyr)
library(vtable)
library(ggplot2)
library(readr)
library(tidyverse)
library(stringr)
library(lubridate)
```

## Introduction



This research exploration takes a close look at the gender wage gap over the years. While the wage gap has decreased, women are still making on average, about 82 cents for every dollar men make (Aragao, 2023). Women are entering the workforce at a higher rate than in the past, yet are still not making the same salary as men who work the same jobs. 

From the two line graphs below we can see that women 16 years and older, working full time, are increasingly entering the workforce (Graph 1: Percent of Men and Women Working Full Time by Year); yet women are still not making 100% of the wage that men make (Graph 2: Female Salary Percent of Male Salary).

```{r wage gap over time}
#percent of women working full time compared to men
#Still would like to add a legend to this graphs
ggplot(data = employed_gender, aes(x = year)) +
  geom_line(aes(y = full_time_female), colour = "red") +
  geom_point(aes(y = full_time_female), colour = "red") +
  geom_line(aes(y = full_time_male), colour = "blue") +
  geom_point(aes(y = full_time_male), colour = "blue") +
  labs(title = "Percent of Men and Women Working Full Time by Year", 
       x="Year", 
       y="Percent Working") +
  ylim(0,100)

#wage gap by year
#Would also like to add a legend and labels to the this graphs
earnings_female%>%
  filter(str_detect(group,"Total, 16 years and older")) %>%
  ggplot(aes(x = Year)) +
  geom_line(aes(y = percent)) +
  geom_point(aes(y = percent)) +
  labs(title = "Female Salary Percent of Male Salary", 
       x="Year", 
       y="Percent of Salary") +
  ylim(0,100)

```

### The Data set
  

The data used in this exploration and analysis come from the Bureau of Labor Statistics and the Census Bureau. These data describe different variables about women in the workforce across time. The three data frames are: (1) historical data, providing the percent of earnings women make compared to men, broken down by age group and ranging from 1979 - 2011, (2) Another historical dataset providing the workforce information (percent of women and men working full time and part time), by year, ranging from 1968 - 2016, (3) and lastly, detailed data regarding occupation (including two levels of categorization for the occupation), earnings for those occupations by gender, and percent of earnings women make compared to men, ranging from 2013 - 2016.


The tables below provide the descriptive statistics for the dependent variable, womens' wage percent of male wage. The first table is the dependent variable across occupations and year (from 2013 to 2016). The second table below show the dependent variable for women who are 16 years or older, across many years (1979 - 2011).

```{r Descriptive Statistic}
#Descriptive Statistics for the dependent variable: wage percent of male 
SumWage<-data_frame(jobs_gender$year, jobs_gender$wage_percent_of_male)

SumWage<- SumWage%>%
  rename('Year'='jobs_gender$year',
         'wage_percent_of_male' = 'jobs_gender$wage_percent_of_male')
sumtable(SumWage)  

#Descriptive Statistics for the historical data of the Dependent variable: wage percent of male
earnings_female %>%
  group_by(group) %>%
  filter(str_detect(group,"Total, 16 years and older")) %>%
  sumtable()
```

### Research Question

The purpose of the following exploration and analysis is to answer the question: *What are the contributing factors that lead to the gender wage gap to be greater or smaller?* The factors explored in this particular analysis are age and occupation. Occupation is categorized into broad and detailed categories, and will be explored by comparing female dominated fields compared to male dominated fields.

These factors have been explored in the literature, though the question regarding age (Aragao, 2023; Blau & Kahn, 2016; Kochhar, 2023) has been more thoroughly explored than occupation (Wrohlich 2017). Wrohlick, 2017 found that there is less of a wage gap in the public sector when compared to the private sector. The intention of this analysis is to go beyond comparing occupation by private versus public and into male dominated versus female dominated. This analysis has been done considerably less and is an important piece of knowing where to target closing the wage gap. 


### Hypothesis  

According to the research, the wage gap for a woman widens as she gets older (Aragao, 2023; Blau & Kahn, 2016; Kochhar, 2023), and the wage gap is wider for women in the private sector compared to the public sector (Wrohlich 2017). Based on this literature, we hypothesize that younger woman and women working in traditionally female-dominated fields will experience a smaller wage gap than older women and those working in traditionally male-dominated fields.


#### Wage Gap by Age

The graph below shows the average wage gap across age groups. These data show that as women age, the wage gap widens, it takes a particular dip around 35 - 44 years old.

```{r wage gap by age}
#wage gap by age
earnings_female %>%
  group_by(group) %>%
  filter(!str_detect(group,"Total, 16 years and older")) %>%
  summarize(Mean_Percent_salary = mean(percent))%>%
  ggplot(aes(group,Mean_Percent_salary)) +
  geom_col(aes(fill = group)) +
  labs(title = "Female Salary Percent of Male Salary",
       x="Age Group", 
       y="Average Percent of Salary") +
  geom_text(aes(y=Mean_Percent_salary, 
                label=sprintf("%0.2f", round(Mean_Percent_salary, digits = 2)))) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5))

```

One hypothesis for this is that the younger generation is experiencing a more narrow wage gap. And in that case, we would expect to the see wage gap decrease across time.


The graph and table below shows the the wage gap across time using the same data. From these visualizations we can conclude that the wage gap did not decrease, and that as women age, the wage gap widens.

```{r wage by year}
#wage gap by year
SummaryYear <- jobs_gender %>%
  group_by(year)%>%
  drop_na(wage_percent_of_male)%>%
  summarise(Average_Percent_of_Salary = mean(wage_percent_of_male))

kable(SummaryYear)


jobs_gender %>%
  group_by(year)%>%
  drop_na(wage_percent_of_male)%>%
  summarise(Mean_wage_percent_of_males = mean(wage_percent_of_male))%>%
  ggplot(aes(fill = year, y = `Mean_wage_percent_of_males`, x=year)) +
  geom_bar(position = "dodge", stat = "identity") +
  labs(title = "Female Salary Percent of Male Salary by Year",
       x="Year", 
       y="Average Percent of Salary") +
  geom_text(aes(y=Mean_wage_percent_of_males, 
                label=sprintf("%0.2f", round(Mean_wage_percent_of_males, digits = 2)))) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5))

```

#### Wage Gap by Occupation   


The visualization below shows the average number of total female workers versus total male workers averaged across 3 year (2013- 2016), by minor job category. The table is sorted in order to see the categories of which women tend to work at the top.

```{r occupation by gender workers}

#creating a table of just total workers by gender and category
JobsCategoryGen<- data_frame(jobs_gender$year, jobs_gender$minor_category, jobs_gender$workers_male, jobs_gender$workers_female)
JobsCategoryGen<- JobsCategoryGen%>%
  rename('Year'='jobs_gender$year',
         'Occupation Category (Minor)' = 'jobs_gender$minor_category',
         'Total Male Worker' = 'jobs_gender$workers_male',
         'Total Female Workers' = 'jobs_gender$workers_female')

SummaryJobsCatGen <- JobsCategoryGen%>%
  group_by(`Occupation Category (Minor)`)%>%
  summarise(AverageMaleWorkers = mean(`Total Male Worker`), 
            AverageFemaleWorkers = mean(`Total Female Workers`))

kable(SummaryJobsCatGen[order(SummaryJobsCatGen$AverageFemaleWorkers, decreasing=TRUE),])
```

From this visualization, we can see the following are the top 10 occupation categories that are on average more dominated by women:


\(1\) Education, Training, and Library 

\(2\) Sales and Related 

\(3\) Building and Grounds Cleaning and Maintenance 

\(4\) Office and Administrative Support 

\(5\) Healthcare Support 

\(6\) Management 

\(7\) Community and Social Service 

\(8\) Healthcare Practitioners and Technical 

\(9\) Legal 

\(10\) Food Preparation and Serving Related


The following four visualizations below shows the average percent of salary women make compared to men across occupation categories. The first set of categories in more broad than the second, these are the "Major Categories", while the more detailed categories are referred to as "Minor Categories". These categories were created in order to compare the wage gap across occupations in a more digestible way than job title alone. 

Below we can see that there is a higher wage gap for women working in "Management, Business, and Financial" with women making 80.5% of what men make, and those in"Production, Transportation, and Material Moving" with women making 79% of what men make.

```{r wage gap by occupation_major category}
#wage gap by major occupation category
 
SummaryMajorCat <- jobs_gender%>%
  group_by(major_category)%>%
  drop_na(wage_percent_of_male) %>%
  summarise(Average_Percent_of_Salary = mean(wage_percent_of_male))

#I would like to round these numbers by 2 digits past the decimal, as well as title the table and rename the variables.
kable(SummaryMajorCat[order(SummaryMajorCat$Average_Percent_of_Salary, SummaryMajorCat$major_category, decreasing=TRUE),])

#This graph still needs to be reformatted so the title of the graph and the title of legand do not overlap. 
jobs_gender %>%
  group_by(major_category)%>%
  drop_na(wage_percent_of_male)%>%
  summarise(Mean_wage_percent_of_males = mean(wage_percent_of_male))%>%
  ggplot(aes(fill = major_category, y = `Mean_wage_percent_of_males`, x=major_category)) +
  geom_bar(position = "dodge", stat = "identity") +
  labs(title = "Female Salary Percent of Male Salary by Major Occupation Category",
       x="Occupation Cateogry", 
       y="Average Percent of Salary") +
  geom_text(aes(y=Mean_wage_percent_of_males, 
                label=sprintf("%0.2f", round(Mean_wage_percent_of_males, digits = 1)))) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5))

```



When we break these categories down into more detail, we can see more instances of a wider wage gap. Women who work in occupations that fall into the "Community and Social Services" category make, on average, 91% of every dollar a man in their field makes. Whereas a woman working in Production" makes, on average, 77% of every dollar a man in their field makes. There seems to be a bigger increase in wage gap for the following occupational categories: "Management", "Business and Financial Operations", "Transportation", "Farming, Fishing, and Forestry", "Building and Grounds Cleaning and Maintenance", "Sales and Related", "Legal", and "Production".

```{r wage gap by occupation_minor category}
#wagegap by minor occupation category
SummaryMinorCat <- jobs_gender%>%
  group_by(minor_category)%>%
  drop_na(wage_percent_of_male) %>%
  summarise(Mean_wage_percent_of_males = mean(wage_percent_of_male))

kable(SummaryMinorCat[order(SummaryMinorCat$Mean_wage_percent_of_males, SummaryMinorCat$minor_category, decreasing=FALSE),])

#The visualization below is in VERY draft form, and cannot provide helpful information until it is reformatted. 
#jobs_gender %>%
  #group_by(minor_category)%>%
  #drop_na(wage_percent_of_male)%>%
  #summarise(Mean_wage_percent_of_males = mean(wage_percent_of_male))%>%
  #ggplot(aes(fill = minor_category, y = `Mean_wage_percent_of_males`, x=minor_category)) +
  #geom_bar(position = "dodge", stat = "identity") +
  #labs(title = "Female Salary Percent of Male Salary by Minor Occupation Category",
       #x="Occupation Cateogry", 
       #y="Average Percent of Salary") +
  #theme(axis.text.x = element_text(angle = 45, vjust = 0.5))
```

When comparing the top 10 minor occupation categories that are on average more dominated by women ("Occupation Categories Dominated by Women") with the list of occupation categories with the smallest wage gap ("Occupation Categories with the Smallest Wage Gap"), we can see some overlap. 


**Occupation Categories Dominated by Women**

(1) Education, Training, and Library
(2) *Sales and Related*
(3) *Building and Grounds Cleaning and Maintenance*
(4) Office and Administrative Support
(5) Healthcare Support
(6) *Management*
(7) Community and Social Service
(8) Healthcare Practitioners and Technical
(9) *Legal*
(10) Food Preparation and Serving Related

**Occupation Categories with the Smallest Wage Gap**

(1) Production
(2) *Legal*
(3) *Sales and Related*
(4) *Building and Grounds Cleaning and Maintenance*
(5) Farming, Fishing, and Forestry
(6) Transportation
(7) Business and Financial Operations
(8) *Management*
(9) Arts, Design, Entertainment, Sports, and Media
(10) Life, Physical, and Social Science

Further analysis is necessary to know if female dominated occupation categories is a statistically significant factor that contributes to the wage gap.

### Analysis

For the analysis, the first independent variable investigated was whether gender domination in an occupation has a relationship to the female percent of male earnings. We hypothesized that the wage gap is in male dominated occupations, therefore the feamle percent of male earnings would be lower in those occupations. We looked at this in two different ways. 

First, a new variable was created, **gender_dominatedV**. For occupations with 50.1% or higher of females this variable was coded as "0", for occupations made up of 50% or lower of females this variable was coded as "1". 

```{r new categorical variable- binary}
#Using minor_category and percent_female variables to create a new variable of "female dominated" vs. "male dominated"

#gender_dominated<-data_frame(jobs_gender$occupation, jobs_gender$percent_female)

#head(jobs_gender)
kable(gender_dominated[order(gender_dominated$`jobs_gender$percent_female`, gender_dominated$`jobs_gender$occupation`, decreasing = TRUE),])


jobs_gender<-jobs_gender%>%
  mutate(gender_dominatedV = case_when(percent_female >=50.1 ~ 0,
                                       percent_female <=50 ~ 1))
#head(jobs_gender)
```
#### Relationship Between Occupation and Wage Gap

In the two visualizations below, we can see that there is a negative relationship between male dominated occupations and percent of male earnings. This means, women make less of a percent of their male colleagues in male dominated fields, than women working in female dominated fields. The second visualization is taking a different perspective, looking at the percent of women in the field, and the percent of male earnings. Here we can see a positive relationship, again communicating that as the amount of women in an occupation increase (in proportion to men), their percent of male earnings increases. 

```{r relationship between occupation and wage gap}

ggplot(data = jobs_gender, aes(x = wage_percent_of_male, y = gender_dominatedV)) + 
  geom_point() +
  geom_smooth(method = 'lm', se=F)

ggplot(data = jobs_gender, aes(x = wage_percent_of_male, y = percent_female)) + 
  geom_point() +
  geom_smooth(method = 'lm', se=F)
```

To know if this relationship is significant, a regression analysis was run. Missing data were considered in this analysis. The variable with a large amount of missing data was **wage_percent_of_male**, these data were missing due to small sample size for the occupations. Therefore, these missing data was found to be "missing not at random". The regression dropped the missing data, however this could bias the data as it does not include the entire data-set's set of occupations.  

```{r missing data}
summary(jobs_gender)
summary(earnings_female)
summary(employed_gender)

```

```{r regression occupation and wage gap}

summary(GenDomReg<-lm(wage_percent_of_male ~ gender_dominatedV, data = jobs_gender))

summary(GenDomReg2<-lm(wage_percent_of_male ~ percent_female, data = jobs_gender))

```

According to the regressions above, we can conlcude that there is a significant relationship between female percent of male earnings and percent of women in the occupation. That is, the more women in a field, the smaller the wage gap. 

In the first regression, we compared our binary variable to the female percent of male earnings to find a significant, negative relationship. This analysis resulted in a p value of 0.00153 and an adjusted R-squared of 0.00727. From this we can conclude that in male dominated fields, women make less percent of male earnings than in the female dominated fields. 

In the second regression, we compared percent of women in an occupation with female percent of male earnings and found a significant positive relationship. The analysis resulted in a p value of 8.27e-05 and an adjusted R-squared of 0.01163. From this we can gather that as percent of women in an occupation increase, women begin to make more percent of male earnings than women in male dominated fields. 

A third regression was run in order to control for total earnings and total workers. We decided to use the percent of women variable rather than the binary variable because that yeilded a stronger relationship to percent of earnings. 

```{r occupation and wage regression 2}

summary(GenDomReg3<-lm(wage_percent_of_male ~ percent_female + total_earnings + total_workers, data = jobs_gender))

```
These regression results maintain the significant relationship between percent of women in an occupation and their percent of male earnings. However, the significant level decreases (p value of 0.00129), whereas the adjust R-squared increases (0.02039). This means that we have a stronger model as a whole, however the relationship between our IV and DV has lost strength. 

From these regressions we can conclude that the wage gap is statistically significantly greater for women in male-dominated occupations, than it is for women in female-dominated occupations. 

#### Relationship Between Age and Wage Gap

The visualization below shows the relationship between our second independent variable of age group and our dependent variable of female wage percent of male. This visualization tells us that starting at age 25, womens' percent of mens' earnings already starts to decrease, with a significant drop at age 35. The literature believes this to be true due to women beginning to have children (Kochhar, 2023). The literature has found that women with children on average get paid less than women without children, and men with children on average get paid more than men without children (Kochhar, 2023). It is theorized that this is due to an implicit bias that men are expected to provide for their family, where women are expected to be the primary child care provider. 

```{r relationship between age and wage gap}

earnings_female %>%
  filter(!str_detect(group, "Total, 16 years and older"))%>%
  ggplot(aes(x = group, y = percent)) + 
  geom_boxplot() +
  geom_smooth(method = 'lm', se=F)

```

An Analysis of Variance (ANOVA) was run to investigate the relationship between age group and female earnings percent of male, controlling for year. 

```{r ANOVA}
summary(AgeANOVA<-aov(percent~group + Year, data = earnings_female))

```
The results of the ANOVA show a significant relationship between the age groups with a p value of <2e-16. 

A Tukey posthoc analysis was then used to breakdown where the significant differences exited. 

```{r Tukey HSD}
TukeyHSD(AgeANOVA, conf.level = .95)

```

The results of the Tukey show similar results to the boxplot visualization above. When younger women (age groups 16-19 years old) are compared to women 25 years or older, there is a significant difference in percent of male earnings (p value of 0.0000). That is to say, once a women turns 25, she is already getting paid significantly less than her own gender at ages 16-24. What is also shown from the results of this analysis is with every age group jump, a woman makes significantly less than the age group before (p value 0.000) until a woman reaches 55 years old. There is not a significant difference between female earnings for women in the 45 - 54 and 55-64 age groups. Then women a woman turns 65+ she is actually making significantly more than the women in age group before her, yet she is still making an average of about 73% of her male peers. 

### Conclusions

From this analysis we can conlude that there is a signification relationship between both occupation and wage gap as well as age and wage gap. The resulst showed that as the percent of women in an occupation increase, the percent of male earnings also increased. This means that women in female-dominated fields experience a small wage gap than those in male-dominated fields. That said, women in female-dominated fields get paid less on average than women in male-dominated fields. 

We can also conclude that as a woman gets older, she gets paid less percent of male earnings. With every age group jump, a woman made a significantly lower percent of male earnings than the prior age group. 

### Limitations

This investigation had hoped to analyze the interaction between the two independent variables (age and occupation), however the occupation data ranged from 2011 to 2013 and the age data ranged from 1979 to 2011. Therefore, we were unable to look at the interaction between age and occupation, which tells us only a portion of the influence of our independent variables on wage gap. 

### Bibliography
```{R Citations}
#citation("readr")
#citation("ggplot2")
#citation("tidyverse")
#citation("stringr")
#citation("dplyr")
#citation("vtable")
````

Aragão, C., 2023. Gender pay gap in U.S. hasn’t changed much in two decades, Pew Research Center. United States of America. Retrieved from https://policycommons.net/artifacts/3456468/gender-pay-gap-in-us/4256843/ on 29 Apr 2023. CID: 20.500.12592/8mzrnq.

Blau, F. D., & Kahn, L. M. (2017). The gender wage gap: Extent, trends, and explanations. Journal of economic literature, 55(3), 789-865.

H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York, 2016.

Huntington-Klein N (2023). _vtable: Variable Table for Variable Documentation_. R package version 1.4.2,
  <https://CRAN.R-project.org/package=vtable>.
  
Kochhar, R. (2023). The enduring grip of the gender pay gap.

Thomas Mock (2022). Tidy Tuesday: A weekly data project aimed at the R ecosystem. https://github.com/rfordatascience/tidytuesday/tree/master/data/2019/2019-03-05
  
Wickham H (2022). _stringr: Simple, Consistent Wrappers for Common String Operations_. R package version 1.5.0,
  <https://CRAN.R-project.org/package=stringr>.

Wickham H, Averick M, Bryan J, Chang W, McGowan LD, François R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL,
  Miller E, Bache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H
  (2019). “Welcome to the tidyverse.” _Journal of Open Source Software_, *4*(43), 1686. doi:10.21105/joss.01686
  <https://doi.org/10.21105/joss.01686>.
  
Wickham H, François R, Henry L, Müller K, Vaughan D (2023). _dplyr: A Grammar of Data Manipulation_. R package version 1.1.0,
  <https://CRAN.R-project.org/package=dplyr>.
  
Wickham H, Hester J, Bryan J (2023). _readr: Read Rectangular Text Data_. R package version 2.1.4,
  <https://CRAN.R-project.org/package=readr>.
  
Wrohlich, K. (2017). Gender pay gap varies greatly by occupation. DIW Economic Bulletin, 7(43), 429-435.

  






```{r extra code}

#relationship between occupation and wage gap

#jobs_gender%>%
 # group_by(gender_dominatedV)%>%
  #summarise(average_total_earnings=mean(total_earnings))%>%
  #ggplot(aes(gender_dominatedV, average_total_earnings)) +
  #geom_col(aes(fill = gender_dominatedV)) +
  #geom_text(aes(y=average_total_earnings, 
                #label=sprintf("%0.2f", round(average_total_earnings, digits = 2))))

#jobs_gender%>%
  #group_by(gender_dominatedV)%>%
  #summarise(average_wage_percent_of_male=mean(wage_percent_of_male))%>%
  #ggplot(aes(gender_dominatedV, average_wage_percent_of_male)) +
  #geom_col(aes(fill = gender_dominatedV)) +
  #geom_text(aes(y=average_wage_percent_of_male, 
                #label=sprintf("%0.2f", round(average_wage_percent_of_male, digits = 2))))


#gender_dominated2 <- data_frame(jobs_gender$occupation, jobs_gender$gender_dominatedV)

#interaction between IVs
#earnings_female2 <- earnings_female%>%
 # pivot_wider(names_from = group, values_from = percent)%>%
  #rename("year" = "Year")

#head(earnings_female2)
#view(earnings_female2)

#Age_OccupationType <- merge(earnings_female2, employed_gender, by.x ="year")

#view(jobs_gender)
#view(employed_gender)

#head(employed_gender)

#head(Age_Occupation)
#view(Age_Occupation)


```
