{
  "hash": "a6aed247fe3da9451e3b7ef91696a805",
  "result": {
    "markdown": "---\ntitle: \"Final Project Part 2\"\nauthor: \"Tyler Tewksbury\"\ndesription: \"Second Final Project check-in\"\ndate: \"04/20/2023\"\nformat:\n  html:\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - finalpart2\n  - tyler tewksbury\n  - chess\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nknitr::opts_chunk$set(echo = TRUE)\n```\n:::\n\n\n## Background and Research Question\n\nIn 2020, after the release of the Netflix series *The Queen's Gambit*, interest in chess was at an all-time high. This led many fans of the show to use popular websites such as Chess.com and Lichess.org to begin learning the game. These websites use a rating system that mimics that of official in-person chess leagues, increasing your rating number as you win and decreasing as you lose. This can be used to measure one's skill in chess, and determining if they can enter certain competitions. \n\nWhen playing chess online, as you face someone completely random that the website matches you against, there is no guarantee that you will play against someone with an identical rating. Thus, there will typically be a difference between the two players' rating. Obviously the player with the higher rating would be more likely to win, right? That is where this study comes in. By quantifying the effect of rating difference on win chance, players may be able to understand more about the match they are currently in. Knowing how likely they are to win, how likely their opponent is to win, and this could lead to further interesting research about making the most fair chess matches possible. As there are not any academic studies on the topic, there is no proven indicator that a slight discrepancy in rating has is an indicator to a player's win chance. This poses the research question: \n\n**How strong of a predictor is the difference between players chess rating in determining the victor?**\n\n\n## Dataset\n\nThe dataset being used is sourced from Kaggle: https://www.kaggle.com/datasets/datasnaek/chess\n\nGathered in 2016, the dataset contains information from over 20,000 matches on Lichess.org via the Lichess API. Information on the players', their opening moves, the results of the match, and more are all columns within the dataset. There was no selection criteria - it was simply the most recent games taken from the top 100 teams on the Lichess website, consisting of over 1,500 players. This should provide an adequate sample for building regression models.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#reading in the dataset\nchess <- read.csv(\"_data/chess_games.csv\")\n```\n:::\n\n\n## Descriptive Statistics \n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(chess)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t20058 obs. of  16 variables:\n $ id            : chr  \"TZJHLljE\" \"l1NXvwaE\" \"mIICvQHh\" \"kWKvrqYL\" ...\n $ rated         : chr  \"FALSE\" \"TRUE\" \"TRUE\" \"TRUE\" ...\n $ created_at    : num  1.5e+12 1.5e+12 1.5e+12 1.5e+12 1.5e+12 ...\n $ last_move_at  : num  1.5e+12 1.5e+12 1.5e+12 1.5e+12 1.5e+12 ...\n $ turns         : int  13 16 61 61 95 5 33 9 66 119 ...\n $ victory_status: chr  \"outoftime\" \"resign\" \"mate\" \"mate\" ...\n $ winner        : chr  \"white\" \"black\" \"white\" \"white\" ...\n $ increment_code: chr  \"15+2\" \"5+10\" \"5+10\" \"20+0\" ...\n $ white_id      : chr  \"bourgris\" \"a-00\" \"ischia\" \"daniamurashov\" ...\n $ white_rating  : int  1500 1322 1496 1439 1523 1250 1520 1413 1439 1381 ...\n $ black_id      : chr  \"a-00\" \"skinnerua\" \"a-00\" \"adivanov2009\" ...\n $ black_rating  : int  1191 1261 1500 1454 1469 1002 1423 2108 1392 1209 ...\n $ moves         : chr  \"d4 d5 c4 c6 cxd5 e6 dxe6 fxe6 Nf3 Bb4+ Nc3 Ba5 Bf4\" \"d4 Nc6 e4 e5 f4 f6 dxe5 fxe5 fxe5 Nxe5 Qd4 Nc6 Qe5+ Nxe5 c4 Bb4+\" \"e4 e5 d3 d6 Be3 c6 Be2 b5 Nd2 a5 a4 c5 axb5 Nc6 bxc6 Ra6 Nc4 a4 c3 a3 Nxa3 Rxa3 Rxa3 c4 dxc4 d5 cxd5 Qxd5 exd5 \"| __truncated__ \"d4 d5 Nf3 Bf5 Nc3 Nf6 Bf4 Ng4 e3 Nc6 Be2 Qd7 O-O O-O-O Nb5 Nb4 Rc1 Nxa2 Ra1 Nb4 Nxa7+ Kb8 Nb5 Bxc2 Bxc7+ Kc8 Qd\"| __truncated__ ...\n $ opening_eco   : chr  \"D10\" \"B00\" \"C20\" \"D02\" ...\n $ opening_name  : chr  \"Slav Defense: Exchange Variation\" \"Nimzowitsch Defense: Kennedy Variation\" \"King's Pawn Game: Leonardis Variation\" \"Queen's Pawn Game: Zukertort Variation\" ...\n $ opening_ply   : int  5 4 3 3 5 4 10 5 6 4 ...\n```\n:::\n:::\n\n\nThe dataset contains 20058 observations across 16 variables. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(chess)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      id               rated             created_at         last_move_at      \n Length:20058       Length:20058       Min.   :1.377e+12   Min.   :1.377e+12  \n Class :character   Class :character   1st Qu.:1.478e+12   1st Qu.:1.478e+12  \n Mode  :character   Mode  :character   Median :1.496e+12   Median :1.496e+12  \n                                       Mean   :1.484e+12   Mean   :1.484e+12  \n                                       3rd Qu.:1.503e+12   3rd Qu.:1.503e+12  \n                                       Max.   :1.504e+12   Max.   :1.504e+12  \n     turns        victory_status        winner          increment_code    \n Min.   :  1.00   Length:20058       Length:20058       Length:20058      \n 1st Qu.: 37.00   Class :character   Class :character   Class :character  \n Median : 55.00   Mode  :character   Mode  :character   Mode  :character  \n Mean   : 60.47                                                           \n 3rd Qu.: 79.00                                                           \n Max.   :349.00                                                           \n   white_id          white_rating    black_id          black_rating \n Length:20058       Min.   : 784   Length:20058       Min.   : 789  \n Class :character   1st Qu.:1398   Class :character   1st Qu.:1391  \n Mode  :character   Median :1567   Mode  :character   Median :1562  \n                    Mean   :1597                      Mean   :1589  \n                    3rd Qu.:1793                      3rd Qu.:1784  \n                    Max.   :2700                      Max.   :2723  \n    moves           opening_eco        opening_name        opening_ply    \n Length:20058       Length:20058       Length:20058       Min.   : 1.000  \n Class :character   Class :character   Class :character   1st Qu.: 3.000  \n Mode  :character   Mode  :character   Mode  :character   Median : 4.000  \n                                                          Mean   : 4.817  \n                                                          3rd Qu.: 6.000  \n                                                          Max.   :28.000  \n```\n:::\n:::\n\nLooking at the summary, it is clear what variables will be used and if any new columns will be added. The following will prove relevance to the research question:\n\n* `rated``\n* `victory_status``\n* `winner`\n* `white_id`\n* `white_rating`\n* `black_id`\n* `black_rating`\n* `turns`\n* `opening_eco`\n* `opening_name`\n\n\nA new column containing the difference between the rating will be added in the next iteration for analysis. Having this added column will make the functions necessary for analysis easier, as calculating the difference will not need to be repeated for each observation. \n\n\n#### white_rating and black_rating\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrange(chess$white_rating)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  784 2700\n```\n:::\n\n```{.r .cell-code}\nrange(chess$black_rating)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  789 2723\n```\n:::\n:::\n\nThe ranges of the two sides are nearly identical, and are quite large nearing 2000. This could be both good and bad for the study, as the large range could prove significant, but it may be necessary to break the models into smaller ranges. This could also be interesting, perhaps seeing if the rating differences at a lower level matter more than that of a higher level, or vice versa.\n\n\n## Proposed Models\n\nThe obvious model for this question will be a a linear probability regression, as the victory status is a binary variable. Proposed models initially are: \n\nLinear probability including unranked\nLinear probability excluding unranked\n\nThere will be more models, potentially differentiating between the different ranges as stated earlier. More possibilities include looking at exclusively drawn game data, analyzing favored openings depending on rank, or possibly finding other predictors if the rank difference is not significant. \n\n## Part 2: Constructing Models\n\nTo begin constructing the models, the difference in rank column needs to be added. This can be done using simple R commands. The victor will also be made into bingary numeric of 0 and 1, 0 being a white victory and 1 being a black victory. Draw results will be removed to allow use of linear probability.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchess <- chess[chess$winner != 'draw' ,]\nchess <- chess %>%\n  mutate(winner = recode(winner, \"white\" = \"0\", \"black\" = \"1\")) %>%\n  mutate(winner = as.numeric(winner))\nchess$rating_diff <- chess$white_rating - chess$black_rating\nrange(chess$rating_diff)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -1605  1499\n```\n:::\n\n```{.r .cell-code}\nhist(chess$rating_diff)\n```\n\n::: {.cell-output-display}\n![](Tyler_Tewksbury_Final2_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\nWith the difference in rating defined, an initial model can be made with the difference as an explanatory variable, and the winner as the response variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwinner1 <- lm(winner ~ rating_diff, data = chess)\nsummary(winner1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = winner ~ rating_diff, data = chess)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.3770 -0.4462 -0.1038  0.4733  1.2555 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  4.821e-01  3.362e-03  143.37   <2e-16 ***\nrating_diff -7.317e-04  1.341e-05  -54.57   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4646 on 19106 degrees of freedom\nMultiple R-squared:  0.1349,\tAdjusted R-squared:  0.1348 \nF-statistic:  2978 on 1 and 19106 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\nThe barebones model shows what was to be expected. A statistically significant relationship between the difference in rating and the outcome of the match. The p value being astronomically low confirms that the explanatory variable undoubtably affectts the dependent variable. Just from this barebones graph though, it is interesting to see how few outliers there are when visualized. Much more can be done both visually and statistically with this dataset however, so let's make more models, first controlling for the amount of turns taken in the match.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwinner2 <- lm(winner ~ rating_diff + turns, data = chess)\nsummary(winner2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = winner ~ rating_diff + turns, data = chess)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.34504 -0.44679 -0.09632  0.47048  1.24682 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  4.524e-01  7.018e-03  64.467  < 2e-16 ***\nrating_diff -7.295e-04  1.341e-05 -54.399  < 2e-16 ***\nturns        5.009e-04  1.040e-04   4.815 1.48e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4643 on 19105 degrees of freedom\nMultiple R-squared:  0.1359,\tAdjusted R-squared:  0.1358 \nF-statistic:  1502 on 2 and 19105 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nplot(x = chess$rating_diff, \n     y = chess$winner)\nabline(winner1, col = \"green\")\nabline(h = .5, lty = 2, col = \"black\")\nabline(v = 0, lty = 2, col = \"darkred\")\nabline(winner2, col = \"red\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in abline(winner2, col = \"red\"): only using the first two of 3\nregression coefficients\n```\n:::\n\n::: {.cell-output-display}\n![](Tyler_Tewksbury_Final2_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\nI included the original regression line to show for comparison. The color will be green to easily differentiate it from future regression models. When controlling for the amount of turns taken in the match, a line slightly favoring a black victory is created. This is interesting, potentially implying that the amount of turns may matter more as the white player. This result is also statistically significant, as all of the models likely will be, given the obvious relationship between the two main variables.\n\nThe third model that will be tested is a probit regression, as well as using a predict function to create a more appealing and more applicable regression line. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nwinner3 <- glm(winner ~ rating_diff, family = binomial(link = \"logit\"), data = chess)\nplot(x = chess$rating_diff, \n     y = chess$winner)\nx <- seq(-1500, 1500, 10)\ny <- predict(winner3, list(rating_diff = x), type = \"response\")\nlines(x, y)\n```\n\n::: {.cell-output-display}\n![](Tyler_Tewksbury_Final2_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\nThe probit model aims to determine the likelihood that a victory will occur based on the rating difference. This differs from the previous linear models, as the predicted value can exceed the binary range that we are looking for (the victory). By using a probit (or logit) model, as well as an s curve to visualize, this will prove more beneficial for future models.\n\n##Continued Work\n\nMore models can and will be made using this data. As I further my knowledge of regression, as well as spend time working with the dataset. This check-in was just to show that I have *something*, and I plan to upload a \"check-in 2.5\" as time permits prior to the final submission. \n\nSome example changes to future models are:\nExcluding extreme outliers\nNarrowing down the difference range significantly to see if a difference of just 10-20 points is significant\nTesting with more different opening  moves to see the difference they could make\n\nI also anticipate to improve the visualization aspect, with more interesting labels and colors to differentiate between models on a single visualization. The final poster will not have room to have many different models with differing visualizations, so it is important to make the few visualizations as clear and detailed as possible. ",
    "supporting": [
      "Tyler_Tewksbury_Final2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}