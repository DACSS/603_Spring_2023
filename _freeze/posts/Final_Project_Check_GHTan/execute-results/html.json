{
  "hash": "3a49d00f5c8085ef1e1fe112b1c6a1f6",
  "result": {
    "markdown": "---\ntitle: \"Final Project\"\nauthor: \"Guanhua Tan\"\ndescription: \"Final Project\"\ndate: \"May 4 2023\"\nformat:\n  html:\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - fp\n  - research question\n  - desriptive statistics\n  - model\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dbplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dbplyr'\n\nThe following objects are masked from 'package:dplyr':\n\n    ident, sql\n```\n:::\n\n```{.r .cell-code}\nlibrary(stargazer)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nPlease cite as: \n\n Hlavac, Marek (2022). stargazer: Well-Formatted Regression and Summary Statistics Tables.\n R package version 5.2.3. https://CRAN.R-project.org/package=stargazer \n```\n:::\n\n```{.r .cell-code}\nlibrary(misty)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n|-------------------------------------|\n| misty 0.4.9 (2023-05-02)            |\n| Miscellaneous Functions T. Yanagida |\n|-------------------------------------|\n```\n:::\n\n```{.r .cell-code}\nlibrary(reshape2)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'reshape2'\n\nThe following object is masked from 'package:tidyr':\n\n    smiths\n```\n:::\n\n```{.r .cell-code}\npisa <- read_csv('_data/CY07_MSU_SCH_QQQ.csv')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nNew names:\nRows: 21903 Columns: 198\n── Column specification\n──────────────────────────────────────────────────────── Delimiter: \",\" chr\n(8): CNT, CYC, NatCen, STRATUM, SUBNATIO, SC053D11TA, PRIVATESCH, VER_DAT dbl\n(189): ...1, CNTRYID, CNTSCHID, Region, OECD, ADMINMODE, LANGTEST, SC001... lgl\n(1): BOOKID\nℹ Use `spec()` to retrieve the full column specification for this data. ℹ\nSpecify the column types or set `show_col_types = FALSE` to quiet this message.\n• `` -> `...1`\n```\n:::\n:::\n\n\n# Introduction\n\n## Research Questions\n\nThe Organization for Economic Co-operation and Development (OECD), founded in 1960, has conducted a constant series of surveys \"Programme for International Student Assessment\" (PISA) that evaluates 15-year-olds' performance since 2000. The datasets obtained by these surveys have helped governments and education policymakers launch education reforms in an effort to \"meet real-life challenges\" (https://www.oecd.org/pisa/) in their countries. This paper explores the latest survey in 2018. Because the survey covers a wide range of issues regarding students' performance and schools' situations, my final project will narrow to investigate the relationship between career guidance and access to digital devices in schools.\n\n## Hpyotheis\n\nI propose that the scores of access to digital devices may be the major factor to career guidance. Also, I propose that school types and urban settings may be cofunders.\n\nA.  the scores of access to digital devices may be the major factor in career guidance\nB.  OECD, school types, and urban settings may be co-founders.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# tidy data\n# create a data frame\n#view(pisa)\n# select related variable\npisa_selected <- select(pisa, starts_with(c(\"SC161\",\"SC155\", \"SC001Q01TA\", \"SC013Q01TA\")))\npisa2018_joint <-cbind(pisa[, 1:12], pisa_selected)\n# pisa_SC155\npisa2018_joint$Digitals=rowMeans(pisa2018_joint[,c(\"SC155Q01HA\",\"SC155Q02HA\",                                                  \"SC155Q03HA\",\"SC155Q04HA\",\"SC155Q05HA\",\"SC155Q06HA\", \"SC155Q07HA\",\"SC155Q08HA\",\"SC155Q09HA\", \"SC155Q10HA\", \"SC155Q11HA\")])\npisa2018_joint$Career_Guidance=rowSums(pisa2018_joint[, c(\"SC161Q02SA\",\"SC161Q03SA\",\"SC161Q04SA\",\"SC161Q04SA\")])\npisa_SC155 <- pisa2018_joint %>%\n  select(CNT, STRATUM, OECD, Career_Guidance,Digitals, SC001Q01TA, SC013Q01TA) %>%\n  mutate(Urban=SC001Q01TA, Public_or_Private=SC013Q01TA) %>%\n  select(-c(SC001Q01TA, SC013Q01TA)) %>%\n  select(c(CNT,STRATUM,OECD,Urban, Public_or_Private,Career_Guidance,Digitals))\npisa_SC155\n```\n:::\n\n\n# Descriptive Statistics\n\nThis original OECD PISA 2018 School Questionnaire Dataset is one part of PISA 2018 dataset with a focus on schools. It covers 80 countries and regions all over the world. The dataset documents 21,903 schools' responses regarding 187 questions. After cleaning the data, the dataset includes 7 variables: \"CNT\" identifies countries. \"STRATUM\" identifies schools. \"OECD\" indicates if a school locates in an OECD country or not. \"Urban\" describes different conditions of urban communities where a school locates. \"Public_or_Private\" presents if a school is public or private. \"Career_Guidance\" demonstrates scores the schools self-report in terms of career guidance. \"Digitals\" reflects schools' access to digital devices.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# summarizing and visualizing data\nsummary(pisa_SC155)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     CNT              STRATUM               OECD            Urban      \n Length:21903       Length:21903       Min.   :0.0000   Min.   :1.000  \n Class :character   Class :character   1st Qu.:0.0000   1st Qu.:2.000  \n Mode  :character   Mode  :character   Median :1.0000   Median :3.000  \n                                       Mean   :0.5171   Mean   :3.007  \n                                       3rd Qu.:1.0000   3rd Qu.:4.000  \n                                       Max.   :1.0000   Max.   :5.000  \n                                                        NA's   :1363   \n Public_or_Private Career_Guidance    Digitals    \n Min.   :1.00      Min.   :0.000   Min.   :1.000  \n 1st Qu.:1.00      1st Qu.:1.000   1st Qu.:2.273  \n Median :1.00      Median :1.000   Median :2.636  \n Mean   :1.19      Mean   :1.518   Mean   :2.664  \n 3rd Qu.:1.00      3rd Qu.:2.000   3rd Qu.:3.000  \n Max.   :2.00      Max.   :4.000   Max.   :4.000  \n NA's   :2092      NA's   :1499    NA's   :1399   \n```\n:::\n\n```{.r .cell-code}\npisa_SC155_boxplot<-pisa_SC155 %>%\n  select(STRATUM, Career_Guidance, Digitals) %>% \n  pivot_longer(cols=c(Career_Guidance, Digitals), \n               names_to = \"Group\", values_to = \"Evaluation\")\n\nggplot(pisa_SC155_boxplot,aes(Evaluation, fill=Group))+\n  stat_boxplot(geom = \"errorbar\", # Error bars\n               width = 0.2)+\n  geom_boxplot()+\n  facet_wrap(~Group)+\n  labs(title=\"Pisa2018 Evaluation\")+\n  coord_flip()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2898 rows containing non-finite values (`stat_boxplot()`).\nRemoved 2898 rows containing non-finite values (`stat_boxplot()`).\n```\n:::\n\n::: {.cell-output-display}\n![](Final_Project_Check_GHTan_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nAfter using the summary function and visualization, I have already show the descriptive statistics. A large number of NA stands out. Now I will figure out how to deal with them properly.\n\n# Analysis\n\n## Discussion on NA\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# missing data\nlibrary(naniar)\npisa_SC115_nonOECD <- filter(pisa_SC155, OECD == \"0\")\npisa_SC115_OECD <- filter(pisa_SC155, OECD == \"1\")\nvis_miss(pisa_SC155)\n```\n\n::: {.cell-output-display}\n![](Final_Project_Check_GHTan_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nvis_miss(pisa_SC115_nonOECD)\n```\n\n::: {.cell-output-display}\n![](Final_Project_Check_GHTan_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\nvis_miss(pisa_SC115_OECD)\n```\n\n::: {.cell-output-display}\n![](Final_Project_Check_GHTan_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n:::\n\n\nThe graphics have disclose that compared with NON-OECD countries, OECD countries missed more data in terms of school type and career guidance. I believe that missing data are not caused by the poor technological condition in non-OECD countries. So missing data is random and can be dropped.\n\n## Model Evaluation on Linear Regression and Logistic Regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\npisa_SC155_NoNA <- drop_na(pisa_SC155)\n#summary(pisa_SC155_NoNA)\n\nmodel_1 <-lm(Career_Guidance~Urban+Public_or_Private+Digitals+Urban*Digitals, data = pisa_SC155_NoNA)\n#summary(model_1)\n\nmodel_2 <-lm(Career_Guidance~Urban+Public_or_Private+Public_or_Private*Digitals, data = pisa_SC155_NoNA)\n#summary(model_2)\n\nmodel_3 <-lm(Career_Guidance~Urban+Public_or_Private+Digitals, data = pisa_SC155_NoNA)\n#summary(model_3)\n\nmodel_4 <-lm(Career_Guidance~Urban+Public_or_Private+OECD+Digitals, data = pisa_SC155_NoNA)\n\nstargazer(model_1, model_2, model_3, model_4, type = 'text')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n======================================================================================================================================\n                                                                       Dependent variable:                                            \n                           -----------------------------------------------------------------------------------------------------------\n                                                                         Career_Guidance                                              \n                                      (1)                        (2)                        (3)                        (4)            \n--------------------------------------------------------------------------------------------------------------------------------------\nUrban                                0.006                     0.047***                   0.047***                   0.045***         \n                                    (0.025)                    (0.006)                    (0.006)                    (0.006)          \n                                                                                                                                      \nPublic_or_Private                   0.134***                   0.297***                   0.137***                   0.140***         \n                                    (0.019)                    (0.091)                    (0.019)                    (0.019)          \n                                                                                                                                      \nOECD                                                                                                                 0.262***         \n                                                                                                                     (0.014)          \n                                                                                                                                      \nDigitals                            0.162***                   0.276***                   0.210***                   0.198***         \n                                    (0.030)                    (0.039)                    (0.012)                    (0.012)          \n                                                                                                                                      \nUrban:Digitals                       0.016*                                                                                           \n                                    (0.009)                                                                                           \n                                                                                                                                      \nPublic_or_Private:Digitals                                     -0.056*                                                                \n                                                               (0.031)                                                                \n                                                                                                                                      \nConstant                            0.788***                   0.473***                   0.660***                   0.559***         \n                                    (0.083)                    (0.110)                    (0.037)                    (0.037)          \n                                                                                                                                      \n--------------------------------------------------------------------------------------------------------------------------------------\nObservations                         18,563                     18,563                     18,563                     18,563          \nR2                                   0.030                      0.030                      0.030                      0.047           \nAdjusted R2                          0.030                      0.030                      0.029                      0.047           \nResidual Std. Error            0.975 (df = 18558)         0.975 (df = 18558)         0.975 (df = 18559)         0.966 (df = 18558)    \nF Statistic                142.347*** (df = 4; 18558) 142.420*** (df = 4; 18558) 188.786*** (df = 3; 18559) 229.446*** (df = 4; 18558)\n======================================================================================================================================\nNote:                                                                                                      *p<0.1; **p<0.05; ***p<0.01\n```\n:::\n:::\n\n\nAfter the linear regression model comparison, model_4 presents statistical significance on all independent variables. The career guidance depends on urban situations, school styles and the access to digital devices.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# diagnostics\npar(mfrow=c(2,3))\nplot(model_4, which= 1:6)\n```\n\n::: {.cell-output-display}\n![](Final_Project_Check_GHTan_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# logistic regression and AICs\n\npisa_SC155_NoNA$Career_Guidance_Ordinal <- as.factor(pisa_SC155_NoNA$Career_Guidance)\nclass(pisa_SC155_NoNA$Career_Guidance_Ordinal)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"factor\"\n```\n:::\n\n```{.r .cell-code}\ntable(pisa_SC155_NoNA$Career_Guidance_Ordinal)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n   0    1    2    3    4 \n2308 7982 5296 2231  746 \n```\n:::\n\n```{.r .cell-code}\nfit2<-polr(Career_Guidance_Ordinal~Urban+Public_or_Private+OECD+Digitals, data = pisa_SC155_NoNA, Hess=T)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in polr(Career_Guidance_Ordinal ~ Urban + Public_or_Private + OECD + : could not find function \"polr\"\n```\n:::\n\n```{.r .cell-code}\nsummary(fit2)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'fit2' not found\n```\n:::\n\n```{.r .cell-code}\nbroom::glance(model_4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 12\n  r.squared adj.r.squared sigma statistic   p.value    df  logLik    AIC    BIC\n      <dbl>         <dbl> <dbl>     <dbl>     <dbl> <dbl>   <dbl>  <dbl>  <dbl>\n1    0.0471        0.0469 0.966      229. 1.31e-192     4 -25701. 51414. 51461.\n# ℹ 3 more variables: deviance <dbl>, df.residual <int>, nobs <int>\n```\n:::\n:::\n\n\nBut model_4 still shows the relative lower R squared. In addition, the diagnostics plots show certain patterns. Both remind me of further exploring a different model. So I move to try the logistic regression model and calculate the AICs for this two models. Finally, the logistic regression model (fit2) has a lower AIC.\n\n## Interpret the Model\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Interpret and Visualize the fit2\nlibrary(MASS)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'MASS'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    select\n```\n:::\n\n```{.r .cell-code}\nnewdat <- data.frame(\n  Urban = rep(1:5, 3712),\n  Public_or_Private = rep(1:2, each = 9280 ),\n  OECD = rep(0:1, eache = 9280),\n  Digitals = rep(1:4, 4640))\n\nnewdat <- cbind(newdat, predict(fit2, newdat, type = \"probs\"))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'fit2' not found\n```\n:::\n\n```{.r .cell-code}\nlnewdat <- melt(newdat, id.vars = c(\"Urban\", \"Public_or_Private\", \"OECD\",  \"Digitals\"),\n                variable.name = \"Level\", value.name=\"Probability\")\n\nggplot(lnewdat, aes(x = Digitals, y = Probability, colour = Level))+\n  geom_line() + \n  facet_grid(Urban ~ Public_or_Private~OECD , labeller=\"label_both\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in `geom_line()`:\n! Problem while computing aesthetics.\nℹ Error occurred in the 1st layer.\nCaused by error:\n! object 'Probability' not found\n```\n:::\n:::\n\n\nThe graphics have reflected the complexities of the relationship between \"Career_Guidance\" and \"Digitial.\" The relationship has slightly distinct patterns in non-OECD and OECD countries. In non-OECD countries, with the lower levels (0 and 1) of \"Career Guidance\", the possibility remain almost unchanged as \"Digitals\" increases. However, in OECD countries, with the lowers of \"Career Guidance\", the possibility will drop when \"Digitals\" goes up. With the higher levels (2 and 3), the possibility will increase when \"Digitals\" increases in both groups of countries. But when \"Career Guidance\" reaches to 4, the possibility approaches to zero because the sample is too tiny.\n\n# Conclusion\n\nMy project has reflected the complexities of the relationship between \"Career_Guidance\" and \"Digitials.\" The relationship has slightly distinct patterns in non-OECD and OECD countries.\n\n# Reference\n\nOECD PISA 2018 School Questionnaire Dataset-https://www.kaggle.com/datasets/dilaraahan/pisa-2018-school-questionnaire?resource=download OECD PISA2018 Code Book-https://www.oecd.org/pisa/data/2018database/ PISA2018 \"School Questionnaire\"-https://www.oecd.org/pisa/data/2018database/CY7_201710_QST_MS_SCQ_NoNotes_final.pdf OECD PISA website-https://www.oecd.org/pisa\n\nR Language as programming language\n\nWickham, H., & Grolemund, G. (2016). *R for data science: Visualize, model, transform, tidy, and import data*. OReilly Media.\n\nDanielle Navarro (2023), *Learning statistics with R: A tutorial for psychology students and other beginners (Version 0.6)* :https://learningstatisticswithr.com/lsr-0.6.pdf\n\nChristoph Hanck, Martin Arnold, Alexander Gerber, and Martin Schmelzer (2023). *Introduction to Econometrics with R*: https://www.econometrics-with-r.org/index.html\n",
    "supporting": [
      "Final_Project_Check_GHTan_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}